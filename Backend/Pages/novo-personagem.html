<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Novo Personagem</title>
  <link rel="icon" type="image/x-icon" href="./assets/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="./assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="./assets/favicon-16x16.png">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <i data-lucide="user-plus" class="header-icon"></i>
        <h1>Criar Novo Personagem</h1>
      </div>
      <p class="header-subtitle">Preencha as informações básicas do seu personagem</p>
    </header>

    <!-- Main Form -->
    <main class="main-content">
      <!-- Nome do Personagem - Destaque -->
      <div class="character-name-section">
        <div class="input-group featured">
          <label for="nome-personagem">
            <i data-lucide="user"></i>
            Nome do Personagem
          </label>
          <input type="text" id="nome-personagem" placeholder="Ex: Aragorn, Legolas, Gimli..." />
        </div>
      </div>

      <!-- Informações Básicas -->
      <div class="form-section">
        <h2><i data-lucide="info"></i> Informações Básicas</h2>
        <div class="form-grid">
          <div class="input-group">
            <label for="classe-nivel">
              <i data-lucide="sword"></i>
              Classe e Nível
            </label>
            <input type="text" id="classe-nivel" placeholder="Ex: Guerreiro Nível 1" />
          </div>
          <div class="input-group">
            <label for="antecedente">
              <i data-lucide="scroll-text"></i>
              Antecedente
            </label>
            <input type="text" id="antecedente" placeholder="Ex: Soldado, Artesão, Nobre" />
          </div>
          <div class="input-group">
            <label for="nome-jogador">
              <i data-lucide="user-circle"></i>
              Nome do Jogador
            </label>
            <input type="text" id="nome-jogador" placeholder="Seu nome" />
          </div>
        </div>
      </div>

      <!-- Características Raciais -->
      <div class="form-section">
        <h2><i data-lucide="users"></i> Características</h2>
        <div class="form-grid">
          <div class="input-group">
            <label for="raca">
              <i data-lucide="crown"></i>
              Raça
            </label>
            <input type="text" id="raca" placeholder="Ex: Humano, Elfo, Anão" />
          </div>
          <div class="input-group">
            <label for="alinhamento">
              <i data-lucide="compass"></i>
              Alinhamento
            </label>
            <input type="text" id="alinhamento" placeholder="Ex: Leal e Bom" />
          </div>
          <div class="input-group">
            <label for="pontos_experiencia">
              <i data-lucide="star"></i>
              Pontos de Experiência
            </label>
            <input type="number" id="pontos_experiencia" placeholder="0" min="0" />
          </div>
        </div>
      </div>

      <!-- Atributos de Combate -->
      <div class="form-section">
        <h2><i data-lucide="shield"></i> Atributos de Combate</h2>
        <div class="form-grid">
          <div class="input-group">
            <label for="classe-armadura">
              <i data-lucide="shield-check"></i>
              Classe de Armadura
            </label>
            <input type="number" id="classe-armadura" placeholder="10" min="1" />
          </div>
          <div class="input-group">
            <label for="iniciativa">
              <i data-lucide="zap"></i>
              Iniciativa
            </label>
            <input type="number" id="iniciativa" placeholder="0" />
          </div>
          <div class="input-group">
            <label for="deslocamento">
              <i data-lucide="move"></i>
              Deslocamento
            </label>
            <input type="number" id="deslocamento" placeholder="30" min="0" />
          </div>
        </div>
      </div>

      <!-- Pontos de Vida -->
      <div class="form-section">
        <h2><i data-lucide="heart"></i> Pontos de Vida</h2>
        <div class="form-grid">
          <div class="input-group">
            <label for="pontos_vida_max">
              <i data-lucide="heart-pulse"></i>
              Pontos de Vida Máximos
            </label>
            <input type="number" id="pontos_vida_max" placeholder="8" min="1" />
          </div>
          <div class="input-group">
            <label for="pontos_vida_atual">
              <i data-lucide="activity"></i>
              Pontos de Vida Atuais
            </label>
            <input type="number" id="pontos_vida_atual" placeholder="8" min="0" />
          </div>
          <div class="input-group">
            <label for="pontos_vida_temp">
              <i data-lucide="plus-circle"></i>
              Pontos de Vida Temporários
            </label>
            <input type="number" id="pontos_vida_temp" placeholder="0" min="0" />
          </div>
        </div>
      </div>

      <!-- Testes de Morte -->
      <div class="form-section">
        <h2><i data-lucide="skull"></i> Testes Contra a Morte</h2>
        <div class="death-saves">
          <div class="save-group">
            <label for="dado-vida">
              <i data-lucide="dice-6"></i>
              Dado de Vida
            </label>
            <input type="text" id="dado-vida" placeholder="1d8" />
          </div>
          <div class="saves-checkboxes">
            <div class="save-type">
              <h3><i data-lucide="check-circle"></i> Sucessos</h3>
              <div class="checkboxes">
                <label class="checkbox-label">
                  <input type="checkbox" id="sucesso1" />
                  <span class="checkmark success"></span>
                  1
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="sucesso2" />
                  <span class="checkmark success"></span>
                  2
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="sucesso3" />
                  <span class="checkmark success"></span>
                  3
                </label>
              </div>
            </div>
            <div class="save-type">
              <h3><i data-lucide="x-circle"></i> Falhas</h3>
              <div class="checkboxes">
                <label class="checkbox-label">
                  <input type="checkbox" id="falha1" />
                  <span class="checkmark failure"></span>
                  1
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="falha2" />
                  <span class="checkmark failure"></span>
                  2
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="falha3" />
                  <span class="checkmark failure"></span>
                  3
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Personalidade -->
      <div class="form-section">
        <h2><i data-lucide="brain"></i> Personalidade</h2>
        <div class="form-grid">
          <div class="input-group">
            <label for="traços_personalidade">
              <i data-lucide="smile"></i>
              Traços de Personalidade
            </label>
            <input type="text" id="traços_personalidade" placeholder="Ex: Corajoso, Determinado..." />
          </div>
          <div class="input-group">
            <label for="ideais">
              <i data-lucide="target"></i>
              Ideais
            </label>
            <input type="text" id="ideais" placeholder="Ex: Justiça, Liberdade..." />
          </div>
          <div class="input-group">
            <label for="vínculos">
              <i data-lucide="link"></i>
              Vínculos
            </label>
            <input type="text" id="vínculos" placeholder="Ex: Família, Honra..." />
          </div>
          <div class="input-group">
            <label for="fraquezas">
              <i data-lucide="alert-triangle"></i>
              Fraquezas
            </label>
            <input type="text" id="fraquezas" placeholder="Ex: Teimoso, Impulsivo..." />
          </div>
        </div>
      </div>

      <!-- Características Físicas -->
      <div class="form-section">
        <h2><i data-lucide="eye"></i> Características Físicas</h2>
        <div class="form-grid">
          <div class="input-group">
            <label for="idade">
              <i data-lucide="calendar"></i>
              Idade
            </label>
            <input type="number" id="idade" placeholder="25" min="1" />
          </div>
          <div class="input-group">
            <label for="altura">
              <i data-lucide="ruler"></i>
              Altura
            </label>
            <input type="text" id="altura" placeholder="1,75m" />
          </div>
          <div class="input-group">
            <label for="peso">
              <i data-lucide="weight"></i>
              Peso
            </label>
            <input type="text" id="peso" placeholder="70kg" />
          </div>
          <div class="input-group">
            <label for="cor_olhos">
              <i data-lucide="eye"></i>
              Cor dos Olhos
            </label>
            <input type="text" id="cor_olhos" placeholder="Castanhos" />
          </div>
          <div class="input-group">
            <label for="cor_pele">
              <i data-lucide="palette"></i>
              Cor da Pele
            </label>
            <input type="text" id="cor_pele" placeholder="Morena" />
          </div>
          <div class="input-group">
            <label for="cor_cabelo">
              <i data-lucide="scissors"></i>
              Cor do Cabelo
            </label>
            <input type="text" id="cor_cabelo" placeholder="Preto" />
          </div>
        </div>
      </div>

      <!-- Características Adicionais -->
      <div class="form-section">
        <h2><i data-lucide="file-text"></i> Características Adicionais</h2>
        <div class="input-group full-width">
          <label for="caracteristicas-adicionais">
            <i data-lucide="pen-tool"></i>
            Descreva características especiais, marcas distintivas, etc.
          </label>
          <textarea id="caracteristicas-adicionais" rows="3"
            placeholder="Ex: Cicatriz no rosto, tatuagem no braço, voz grave..."></textarea>
        </div>
      </div>

      <!-- Botão de Salvar -->
      <div class="save-section">
        <button id="btn-salvar" class="btn-save">
          <i data-lucide="save"></i>
          Criar Personagem
        </button>
        <p class="save-note">Após criar, você poderá configurar atributos, habilidades e mais!</p>
      </div>
    </main>
  </div>

  <!-- Navbar -->
  <div class="navbar">
    <button class="active" data-aba="personagem" onclick="irPara('/personagens')">
      <i data-lucide="user"></i>
      <span>Personagem</span>
    </button>
    <button data-aba="atributos" onclick="irPara('/atributos')">
      <i data-lucide="list"></i>
      <span>Atributos</span>
    </button>
    <button data-aba="habilidades" onclick="irPara('/habilidades')">
      <i data-lucide="star"></i>
      <span>Habilidades</span>
    </button>
    <button data-aba="magias" onclick="irPara('/magias')">
      <i data-lucide="zap"></i>
      <span>Magias</span>
    </button>
    <button data-aba="inventario" onclick="irPara('/inventario')">
      <i data-lucide="briefcase"></i>
      <span>Inventário</span>
    </button>
    <button data-aba="jogador" onclick="irPara('/jogador')">
      <i data-lucide="user-circle"></i>
      <span>Jogador</span>
    </button>
  </div>

  <script>
    const API_URL = window.location.origin;

    class AuthCache {
      constructor() {
        this.cacheKey = 'auth_verification_cache';
        this.cacheTimeout = 5 * 60 * 1000; // 5 minutos
      }

      isValid() {
        const cache = this.getCache();
        if (!cache) return false;

        const now = Date.now();
        return (now - cache.timestamp) < this.cacheTimeout;
      }

      getCache() {
        try {
          const cached = localStorage.getItem(this.cacheKey);
          return cached ? JSON.parse(cached) : null;
        } catch {
          return null;
        }
      }

      setCache(isValid) {
        const cache = {
          isValid,
          timestamp: Date.now()
        };
        localStorage.setItem(this.cacheKey, JSON.stringify(cache));
      }

      clearCache() {
        localStorage.removeItem(this.cacheKey);
      }
    }

    const authCache = new AuthCache();

    // Função de verificação com cache
    async function verificarAutenticacao() {
      const token = localStorage.getItem("token");
      if (!token) {
        console.log('Token não encontrado, redirecionando para login');
        authCache.clearCache();
        window.location.href = "/";
        return false;
      }

      // Verifica se temos um cache válido
      if (authCache.isValid()) {
        const cache = authCache.getCache();
        if (cache && cache.isValid) {
          console.log('Usando cache de autenticação válido');
          return true;
        }
      }

      try {
        console.log('Verificando autenticação no servidor...');

        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 8000);

        const res = await fetch(`${API_URL}/profile`, {
          headers: {
            Authorization: `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          signal: controller.signal
        });

        clearTimeout(timeoutId);

        if (res.ok) {
          console.log('Autenticação verificada com sucesso');
          authCache.setCache(true);
          return true;
        } else if (res.status === 401 || res.status === 403) {
          console.log('Token inválido, removendo e redirecionando');
          localStorage.removeItem("token");
          authCache.clearCache();
          window.location.href = "/";
          return false;
        } else {
          // Erro do servidor, mas mantém o cache anterior se existir
          console.log(`Erro do servidor: ${res.status}`);
          const cache = authCache.getCache();
          if (cache && cache.isValid && (Date.now() - cache.timestamp) < 30 * 60 * 1000) { // 30 min
            console.log('Usando cache anterior devido a erro do servidor');
            return true;
          }
          throw new Error(`Server error: ${res.status}`);
        }
      } catch (error) {
        console.error('Erro na verificação de autenticação:', error);

        // Em caso de erro de rede, verifica se temos cache recente
        const cache = authCache.getCache();
        if (cache && cache.isValid && (Date.now() - cache.timestamp) < 30 * 60 * 1000) {
          console.log('Usando cache devido a erro de rede');
          return true;
        }

        // Se não há cache válido e é claramente um erro de rede, não desloga
        if (error.message.includes('NetworkError') || error.message.includes('Failed to fetch') || error.name === 'AbortError') {
          console.log('Erro de rede detectado, mantendo usuário logado');
          return true;
        }

        // Para outros erros, desloga
        localStorage.removeItem("token");
        authCache.clearCache();
        window.location.href = "/";
        return false;
      }
    }

    function irPara(pagina) {
      window.location.href = pagina;
    }

    // Verificar autenticação ao carregar a página
    async function verificarAutenticacao() {
      const token = localStorage.getItem("token");
      if (!token) {
        alert("Você precisa estar logado para criar um personagem.");
        window.location.href = "/login";
        return false;
      }
      return true;
    }

    // Validar formulário
    function validarFormulario() {
      const nome = document.getElementById("nome-personagem").value.trim();
      if (!nome) {
        alert("Por favor, digite o nome do personagem.");
        document.getElementById("nome-personagem").focus();
        return false;
      }

      const classe = document.getElementById("classe-nivel").value.trim();
      if (!classe) {
        alert("Por favor, digite a classe e nível do personagem.");
        document.getElementById("classe-nivel").focus();
        return false;
      }

      return true;
    }

    // Auto-sync vida atual com vida máxima
    document.getElementById("pontos_vida_max").addEventListener("input", function () {
      const vidaMax = this.value;
      const vidaAtual = document.getElementById("pontos_vida_atual");
      if (!vidaAtual.value || vidaAtual.value === "0") {
        vidaAtual.value = vidaMax;
      }
    });

    // Salvar personagem
    document.getElementById("btn-salvar").addEventListener("click", async () => {
      if (!(await verificarAutenticacao())) return;
      if (!validarFormulario()) return;

      const token = localStorage.getItem("token");
      const btnSalvar = document.getElementById("btn-salvar");

      // Desabilitar botão durante salvamento
      btnSalvar.disabled = true;
      btnSalvar.innerHTML = '<i data-lucide="loader-2" class="spinner"></i> Criando...';

      // Função para converter valor de input numérico com fallback para null
      function toInt(id) {
        const val = document.getElementById(id).value;
        return val === "" ? null : parseInt(val, 10);
      }

      // Função para converter checkbox para 1 ou 0
      function toCheckboxInt(id) {
        return document.getElementById(id).checked ? 1 : 0;
      }

      const personagem = {
        nome: document.getElementById("nome-personagem").value.trim(),
        classe_nivel: document.getElementById("classe-nivel").value.trim(),
        antecedente: document.getElementById("antecedente").value.trim(),
        nome_jogador: document.getElementById("nome-jogador").value.trim(),
        raca: document.getElementById("raca").value.trim(),
        alinhamento: document.getElementById("alinhamento").value.trim(),
        pontos_experiencia: toInt("pontos_experiencia"),
        classe_armadura: toInt("classe-armadura"),
        iniciativa: toInt("iniciativa"),
        deslocamento: toInt("deslocamento"),
        pontos_vida_max: toInt("pontos_vida_max"),
        pontos_vida_atual: toInt("pontos_vida_atual"),
        pontos_vida_temp: toInt("pontos_vida_temp"),
        dado_vida: document.getElementById("dado-vida").value.trim(),
        sucesso1: toCheckboxInt("sucesso1"),
        sucesso2: toCheckboxInt("sucesso2"),
        sucesso3: toCheckboxInt("sucesso3"),
        falha1: toCheckboxInt("falha1"),
        falha2: toCheckboxInt("falha2"),
        falha3: toCheckboxInt("falha3"),
        traços_personalidade: document.getElementById("traços_personalidade").value.trim(),
        ideais: document.getElementById("ideais").value.trim(),
        vínculos: document.getElementById("vínculos").value.trim(),
        fraquezas: document.getElementById("fraquezas").value.trim(),
        idade: toInt("idade"),
        altura: document.getElementById("altura").value.trim(),
        peso: document.getElementById("peso").value.trim(),
        cor_olhos: document.getElementById("cor_olhos").value.trim(),
        cor_pele: document.getElementById("cor_pele").value.trim(),
        cor_cabelo: document.getElementById("cor_cabelo").value.trim(),
        caracteristicas_adicionais: document.getElementById("caracteristicas-adicionais").value.trim(),
      };

      try {
        // 🎯 Usando URL dinâmica para criar personagem
        const response = await fetch(`${API_URL}/characters`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`,
          },
          body: JSON.stringify(personagem),
        });

        if (response.ok) {
          const data = await response.json();
          const characterId = data.character.id;

          // Definir este personagem como ativo
          localStorage.setItem('selectedCharacterId', characterId);

          alert(`🎉 Personagem "${personagem.nome}" criado com sucesso! Agora vamos configurar os atributos.`);
          window.location.href = "/atributos";
        } else {
          const errorData = await response.json();
          throw new Error(errorData.error || "Erro desconhecido ao criar personagem");
        }
      } catch (err) {
        console.error("Erro ao criar personagem:", err);
        alert("Erro ao criar personagem: " + err.message);
      } finally {
        // Reabilitar botão
        btnSalvar.disabled = false;
        btnSalvar.innerHTML = '<i data-lucide="save"></i> Criar Personagem';
        lucide.createIcons();
      }
    });

    // Inicializar página
    document.addEventListener('DOMContentLoaded', async () => {
      await verificarAutenticacao();
      lucide.createIcons();
    });
  </script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding-bottom: 80px;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header */
    .header {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      text-align: center;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 10px;
    }

    .header-icon {
      width: 40px;
      height: 40px;
      color: #667eea;
    }

    .header h1 {
      color: #333;
      font-size: 32px;
      font-weight: 700;
    }

    .header-subtitle {
      color: #666;
      font-size: 16px;
    }

    /* Main Content */
    .main-content {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    /* Character Name Section */
    .character-name-section {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .input-group.featured input {
      font-size: 24px;
      font-weight: 600;
      text-align: center;
      border: 3px solid #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    /* Form Sections */
    .form-section {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 25px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .form-section h2 {
      color: #333;
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }

    .form-section h2 i {
      width: 24px;
      height: 24px;
      color: #667eea;
    }

    /* Form Grid */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    /* Input Groups */
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .input-group.full-width {
      grid-column: 1 / -1;
    }

    .input-group label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      color: #555;
      font-size: 14px;
    }

    .input-group label i {
      width: 16px;
      height: 16px;
      color: #667eea;
    }

    .input-group input,
    .input-group textarea {
      padding: 12px 16px;
      border: 2px solid #e1e5e9;
      border-radius: 12px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: #f8f9fa;
    }

    .input-group input:focus,
    .input-group textarea:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .input-group textarea {
      resize: vertical;
      min-height: 80px;
      font-family: inherit;
    }

    /* Death Saves */
    .death-saves {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 30px;
      align-items: start;
    }

    .save-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .save-group label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      color: #555;
      font-size: 14px;
    }

    .saves-checkboxes {
      display: flex;
      gap: 30px;
    }

    .save-type {
      flex: 1;
    }

    .save-type h3 {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 16px;
      color: #555;
      margin-bottom: 15px;
    }

    .save-type h3 i {
      width: 18px;
      height: 18px;
    }

    .checkboxes {
      display: flex;
      gap: 15px;
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-weight: 600;
      color: #555;
    }

    .checkbox-label input {
      display: none;
    }

    .checkmark {
      width: 24px;
      height: 24px;
      border: 2px solid #ddd;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      position: relative;
    }

    .checkmark.success {
      border-color: #4CAF50;
    }

    .checkmark.failure {
      border-color: #f44336;
    }

    .checkbox-label input:checked+.checkmark.success {
      background: #4CAF50;
      border-color: #4CAF50;
    }

    .checkbox-label input:checked+.checkmark.failure {
      background: #f44336;
      border-color: #f44336;
    }

    .checkbox-label input:checked+.checkmark::after {
      content: '✓';
      color: white;
      font-weight: bold;
      font-size: 14px;
    }

    /* Save Section */
    .save-section {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .btn-save {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      padding: 16px 32px;
      background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
      color: white;
      border: none;
      border-radius: 15px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 15px;
    }

    .btn-save:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(76, 175, 80, 0.4);
    }

    .btn-save:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }

    .btn-save i {
      width: 20px;
      height: 20px;
    }

    .save-note {
      color: #666;
      font-size: 14px;
      font-style: italic;
    }

    /* Spinner */
    .spinner {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    /* Navbar */
    .navbar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 70px;
      background: white;
      display: flex;
      justify-content: space-around;
      align-items: flex-end;
      border-top: 1px solid #e1e5e9;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
    }

    .navbar button {
      flex: 1;
      padding: 8px 0;
      background: none;
      border: none;
      font-size: 11px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: #666;
      transition: all 0.3s ease;
    }

    .navbar button i {
      width: 20px;
      height: 20px;
      margin-bottom: 4px;
    }

    .navbar button.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding-top: 15px;
      padding-bottom: 15px;
      font-weight: bold;
      border-radius: 12px 12px 0 0;
    }

    .navbar button:hover:not(.active) {
      color: #667eea;
      transform: translateY(-2px);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }

      .header h1 {
        font-size: 24px;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .death-saves {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .saves-checkboxes {
        flex-direction: column;
        gap: 20px;
      }

      .input-group.featured input {
        font-size: 20px;
      }

      .btn-save {
        font-size: 16px;
        padding: 14px 24px;
      }
    }

    @media (max-width: 480px) {
      .checkboxes {
        justify-content: center;
      }

      .header-content {
        flex-direction: column;
        gap: 10px;
      }

      .header-icon {
        width: 32px;
        height: 32px;
      }
    }

    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .form-section {
      animation: fadeInUp 0.6s ease-out;
    }

    .character-name-section {
      animation: fadeInUp 0.4s ease-out;
    }

    .save-section {
      animation: fadeInUp 0.8s ease-out;
    }
  </style>
</body>

</html>